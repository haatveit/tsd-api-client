#!/bin/bash

JWT_CACHE="$HOME/.tsd-s3cmd-token"

do_authenticated_s3cmd() {
    tacl_auth --interactive --update_cache
    JWT=$(cat $JWT_CACHE)
    s3cmd --add-header=token:$JWT $args
    exit 0
}

args="$*"

if [[ $# -lt 1 ]]; then
    s3cmd
    exit 0
fi

if [[ $1 =~ '-h'|'--help' ]]; then
    s3cmd --help
    exit 0
else
    do_authenticated_s3cmd
    exit 0
fi
